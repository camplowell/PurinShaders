#define brightness 0.35 //[0.00 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.10 0.11 0.12 0.13 0.14 0.15 0.16 0.17 0.18 0.19 0.20 0.21 0.22 0.23 0.24 0.25 0.26 0.27 0.28 0.29 0.30 0.31 0.32 0.33 0.34 0.35 0.36 0.37 0.38 0.39 0.40 0.41 0.42 0.43 0.44 0.45 0.46 0.47 0.48 0.49 0.50 0.51 0.52 0.53 0.54 0.55 0.56 0.57 0.58 0.59 0.60 0.61 0.62 0.63 0.64 0.65 0.66 0.67 0.68 0.69 0.70 0.71 0.72 0.73 0.74 0.75 0.76 0.77 0.78 0.79 0.80 0.81 0.82 0.83 0.84 0.85 0.86 0.87 0.88 0.89 0.90 0.91 0.92 0.93 0.94 0.95 0.96 0.97 0.98 0.99 1.00]
#define contrast 0.80 //[0.50 0.51 0.53 0.54 0.56 0.57 0.59 0.60 0.62 0.63 0.65 0.66 0.68 0.69 0.71 0.72 0.74 0.75 0.77 0.78 0.80 0.81 0.83 0.84 0.86 0.87 0.89 0.90 0.92 0.93 0.95 0.96 0.98 0.99 1.01 1.02 1.04 1.05 1.06 1.08 1.10 1.11 1.13 1.14 1.16 1.17 1.19 1.20 1.22 1.23 1.25 1.26 1.28 1.29 1.31 1.32 1.34 1.35 1.37 1.38 1.40 1.41 1.43 1.44 1.46 1.47 1.49 1.50 1.52 1.53 1.55 1.56 1.58 1.59 1.61 1.62 1.64 1.65 1.67 1.68 1.70 1.71 1.73 1.74 1.76 1.77 1.79 1.80 1.81 1.83 1.84 1.86 1.88 1.89 1.91 1.92 1.93 1.95 1.97 1.98 2.00]
#define toe_size 0.19 //[0.00 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.10 0.11 0.12 0.13 0.14 0.15 0.16 0.17 0.18 0.19 0.20 0.21 0.22 0.23 0.24 0.25 0.26 0.27 0.28 0.29 0.30 0.31 0.32 0.33 0.34 0.35 0.36 0.37 0.38 0.39 0.40 0.41 0.42 0.43 0.44 0.45 0.46 0.47 0.48 0.49 0.50]
#define shoulder_size 0.50 //[0.00 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.10 0.11 0.12 0.13 0.14 0.15 0.16 0.17 0.18 0.19 0.20 0.21 0.22 0.23 0.24 0.25 0.26 0.27 0.28 0.29 0.30 0.31 0.32 0.33 0.34 0.35 0.36 0.37 0.38 0.39 0.40 0.41 0.42 0.43 0.44 0.45 0.46 0.47 0.48 0.49 0.50 0.51 0.52 0.53 0.54 0.55 0.56 0.57 0.58 0.59 0.60 0.61 0.62 0.63 0.64 0.65 0.66 0.67 0.68 0.69 0.70 0.71 0.72 0.73 0.74 0.75 0.76 0.77 0.78 0.79 0.80 0.81 0.82 0.83 0.84 0.85 0.86 0.87 0.88 0.89 0.90 0.91 0.92 0.93 0.94 0.95 0.96 0.97 0.98 0.99 1.00]
#define dynamic_range 4.00 //[1.00 1.25 1.5 1.75 2.00 2.25 2.50 2.75 3.00 3.25 3.50 3.75 4.00 4.25 4.50 4.75 5.00 5.25 5.50 5.75 6.00 6.25 6.50 6.75 7.00 7.25 7.50 7.75 8.00 8.25 8.50 8.75 9.00 9.25 9.50 9.75 10.00 10.25 10.50 10.75 11.00 11.25 11.50 11.75 12.00]
#define overshoot 0.0 //[0.00 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.10 0.11 0.12 0.13 0.14 0.15 0.16 0.17 0.18 0.19 0.20 0.21 0.22 0.23 0.24 0.25 0.26 0.27 0.28 0.29 0.30 0.31 0.32 0.33 0.34 0.35 0.36 0.37 0.38 0.39 0.40 0.41 0.42 0.43 0.44 0.45 0.46 0.47 0.48 0.49 0.50 0.51 0.52 0.53 0.54 0.55 0.56 0.57 0.58 0.59 0.60 0.61 0.62 0.63 0.64 0.65 0.66 0.67 0.68 0.69 0.70 0.71 0.72 0.73 0.74 0.75 0.76 0.77 0.78 0.79 0.80 0.81 0.82 0.83 0.84 0.85 0.86 0.87 0.88 0.89 0.90 0.91 0.92 0.93 0.94 0.95 0.96 0.97 0.98 0.99 1.00]


const float H_y0 = toe_size;
const float H_x0 = (H_y0 - brightness) / contrast + 0.5;
const float H_y1 = 1.0 - shoulder_size;
const float H_x1 = (H_y1 - brightness) / contrast + 0.5;
const float overshootX = exp2(dynamic_range);
const float overshootY = 1.0 + overshoot;

#define H_Eval(x, offX, offY, scaleX, scaleY, B, lnA) (exp(lnA + B * log(max((x - offX) * scaleX, 0.0))) * scaleY + offY)

// Direct parameters to coefficients
#define _slope ((H_x0==H_x1 ? 1.0 : (H_y1-H_y0)/(H_x1-H_x0)))
#define _intercept (H_y0 - H_x0 * _slope)
#define toeM _slope 
#define shoulderM _slope 

const float m_offX = -(_intercept / _slope);
const float m_offY = 0.0;
const float m_scaleX = 1.0;
const float m_scaleY = 1.0;
const float m_B = 1.0;
const float m_lnA = log(_slope);

const float t_offX = 0.0;
const float t_offY = 0.0;
const float t_scaleX = 1.0;
const float t_scaleY = 1.0;
const float t_B = toeM * H_x0 / H_y0;
const float t_lnA = log(H_y0) - t_B * log(H_x0);

const float s_offX = 1.0 + overshootX;
const float s_offY = 1.0 + overshootY;
#define s_x0 (s_offX - H_x1)
#define s_y0 (s_offY - H_y1)
const float s_scaleX = -1.0;
const float s_scaleY = -1.0;
const float s_B = shoulderM * s_x0 / s_y0;
const float s_lnA = log(s_y0) - s_B * log(s_x0);

#undef _slope
#undef _intercept

vec3 Hable(vec3 v) {
   vec3 midMix = vec3(float(v.r > H_x0), float(v.g > H_x0), float(v.b > H_x0));
   vec3 upperMix = vec3(float(v.r > H_x1), float(v.g > H_x1), float(v.b > H_x1));

   vec3 offX = mix(vec3(t_offX), mix(vec3(m_offX), vec3(s_offX), upperMix), midMix);
   vec3 offY = mix(vec3(t_offY), mix(vec3(m_offY), vec3(s_offY), upperMix), midMix);
   vec3 scaleX = mix(vec3(t_scaleX), mix(vec3(m_scaleX), vec3(s_scaleX), upperMix), midMix);
   vec3 scaleY = mix(vec3(t_scaleY), mix(vec3(m_scaleY), vec3(s_scaleY), upperMix), midMix);
   vec3 B = mix(vec3(t_B), mix(vec3(m_B), vec3(s_B), upperMix), midMix);
   vec3 lnA = mix(vec3(t_lnA), mix(vec3(m_lnA), vec3(s_lnA), upperMix), midMix);

   return H_Eval(v, offX, offY, scaleX, scaleY, B, lnA);
}

// Krzysztof Narkowicz's approximate ACES tonemap
vec3 ACES(vec3 v) {
   //v *= 0.6;
   v *= 0.8;
    float a = 2.51;
    float b = 0.03;
    float c = 2.43;
    float d = 0.59;
    float e = 0.14;
    return clamp((v*(a*v+b))/(v*(c*v+d)+e), 0.0, 1.0);
}

vec3 BOTW(vec3 v) {
   v = pow(v, vec3(1.0/1.2));

   float avg = (v.r + v.g + v.b) * 0.2;
   float maxc = max(v.r, max(v.g, v.b));
   float w = 1.0 - pow(1.0 - avg, 2.0);
   float weight = 1.0 + w * 0.18;

   return mix(vec3(maxc), v, weight);
}

vec3 sRGB(vec3 v) {
   return v;
}